CREATE OR REPLACE FUNCTION FUN_DB_CALCULA_TOTVDA_DIASEMANA(
P_DIA_SEMANA IN NUMBER) RETURN NUMBER
IS
-- VARIÁVEL DO TIPO DE DADO DA COLUNA, POIS VAMOS
-- REALIZAR CÁLCULO SOBRE ELA.
V_VL_TOT_VENDA_DIA_SEMANA DB_PEDIDO.VL_TOT_PEDIDO%TYPE;
BEGIN
    -- Função TO_CHAR(DT_PEDIDO,'D') retorna o dia
    -- da semana entre 1 e 7, de acordo com a data do pedido
    SELECT  SUM(VL_TOT_PEDIDO) VAL_TOT_VENDA
    INTO    V_VL_TOT_VENDA_DIA_SEMANA 
    FROM    DB_PEDIDO
    WHERE   TO_CHAR(DT_PEDIDO,'D') = P_DIA_SEMANA; -- Filtro do parâmetro
    
    IF V_VL_TOT_VENDA_DIA_SEMANA IS NULL THEN
        V_VL_TOT_VENDA_DIA_SEMANA  := 00;
    END IF;
    
    -- RETORNANDO A VARIÁVEL COM O CÁLCULO REALIZADO
    RETURN V_VL_TOT_VENDA_DIA_SEMANA ;
EXCEPTION
	WHEN OTHERS THEN
		RAISE_APPLICATION_ERROR (-20010, 'ERRO CRÍTICO NA FUNÇÃO FUN_DB_CALCULA_TOTVDA_DIASEMANA ' || SQLERRM);
		
END FUN_DB_CALCULA_TOTVDA_DIASEMANA;

--
-- SOLICITAMOS QUE SEJA EXIBA AS VENDAS TOTAIS 
-- DO DIA DE DOMINGO (1o DIA DA SEMANA)
--
SELECT FUN_DB_CALCULA_TOTVDA_DIASEMANA(1) FROM DUAL;

