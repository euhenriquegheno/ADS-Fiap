--
-- CRIA A TRIGGER DENTRO DA TABELA DB_PRODUTO
-- E PARA CADA MOVIENTAÇÃO DML UMA NOVA LINHA
-- É GERADA NA TABELA DE AUDITORIA.
CREATE OR REPLACE TRIGGER TRG_DB_AUDITORIA_OPERACAO   
AFTER INSERT OR UPDATE OR DELETE
ON DB_PRODUTO
-- PERCEBA QUE EXISTE A NECESSIDADE DE SE UTILIZAR 
-- A CLÁSULA DECLARE EM TRIGGERS.
DECLARE
    v_evento VARCHAR2(10);
BEGIN
    -- Identificar e armzenar o tipo de evento
    IF INSERTING THEN
        v_evento := 'INSERT';
    ELSIF UPDATING THEN
        v_evento := 'UPDATE';
    ELSIF DELETING THEN
        v_evento := 'DELETE';
    END IF;
    -- Inserir registro na tabela de auditoria
    INSERT INTO DB_AUDITORIA_OPERACAO (
                DT_EVENTO, NM_USUARIO, 
                NM_LOCALIZACAO_EVENTO,
                TP_EVENTO, DS_EVENTO)
    VALUES (SYSDATE, USER, 'DB_PRODUTO', V_EVENTO, 'DML NA TABELA DB_PRODUTO');
END TRG_DB_AUDITORIA_OPERACAO;

