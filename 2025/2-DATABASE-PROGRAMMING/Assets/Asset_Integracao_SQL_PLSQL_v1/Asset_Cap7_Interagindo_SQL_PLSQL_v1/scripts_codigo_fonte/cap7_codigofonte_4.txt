--
-- Script que acesso o banco de dados Oracle 
-- e retorna o valor total de vendas durante o ano corrente
--
SET SERVEROUTPUT ON;
DECLARE
    V_VL_TOTAL_VENDAS 		NUMBER;
	
	-- Estabelecemos uma meta de R$ 10M por ano de vendas
	V_VL_META_ESTABELECIDA 	NUMBER := 10000000;
BEGIN
    -- CONSULTA SQL DIRETAMENTE NO PL/SQL
    SELECT SUM(VL_TOT_PEDIDO)
    INTO V_VL_TOTAL_VENDAS
    FROM  DB_PEDIDO
    WHERE EXTRACT(YEAR FROM DT_PEDIDO) = EXTRACT(YEAR FROM SYSDATE);
	
    -- CRIANDO UM DESVIO DE FLUXO CASO O VALOR TOTAL DE VENDAS
	-- ULTRAPASSE OU NÃO O VALOR DA META ESTABELECIDA.
    IF V_VL_TOTAL_VENDAS > V_VL_META_ESTABELECIDA THEN
        DBMS_OUTPUT.PUT_LINE('VENDAS ACIMA DO ESPERADO PARA O ANO: ' || EXTRACT(YEAR FROM SYSDATE) );
    ELSE
        DBMS_OUTPUT.PUT_LINE('VENDAS ABAIXO DO ESPERADO PARA O ANO: ' || EXTRACT(YEAR FROM SYSDATE) );
    END IF;
END;
/
